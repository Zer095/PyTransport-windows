\doxysection{model.\+h}
\hypertarget{model_8h_source}{}\label{model_8h_source}\index{C:/Users/shcos/OneDrive/Desktop/PyTransport3.0-\/master/PyTransport/PyTransCpp/cppsrc/model.h@{C:/Users/shcos/OneDrive/Desktop/PyTransport3.0-\/master/PyTransport/PyTransCpp/cppsrc/model.h}}
\mbox{\hyperlink{model_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#ifndef\ MODEL\_H\ \ }\textcolor{comment}{//\ Prevents\ the\ class\ being\ re-\/defined}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#define\ MODEL\_H}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}potential.h"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <iostream>}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ <math.h>}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ <cmath>}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{keyword}{using\ namespace\ }std;}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00040\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodel_a89150458364164cfaf05f700365c1416}{model}}}
\DoxyCodeLine{00041\ \{}
\DoxyCodeLine{00042\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{keywordtype}{int}\ nF;\ \ }
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keywordtype}{int}\ nP;\ \ }
\DoxyCodeLine{00045\ \ \ \ \ \mbox{\hyperlink{classpotential}{potential}}\ pot;\ }
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00054\ \ \ \ \ \mbox{\hyperlink{classmodel_a89150458364164cfaf05f700365c1416}{model}}()}
\DoxyCodeLine{00055\ \ \ \ \ \{}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classpotential}{potential}}\ pot\_temp;\ \textcolor{comment}{//\ Use\ a\ temporary\ object\ to\ get\ nP\ and\ nF}}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ nP\ =\ pot\_temp.getnP();}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ nF\ =\ pot\_temp.getnF();}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ member\ 'pot'\ is\ automatically\ default-\/constructed\ here,}}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ so\ no\ need\ to\ explicitly\ initialize\ it\ in\ the\ constructor\ body}}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ unless\ you\ want\ to\ pass\ specific\ arguments\ to\ its\ constructor.}}
\DoxyCodeLine{00062\ \ \ \ \ \}}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classmodel_a04f64273ec4fd6e19ca2189aeb90a8b0}{getnF}}()}
\DoxyCodeLine{00069\ \ \ \ \ \{}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ nF;}
\DoxyCodeLine{00071\ \ \ \ \ \}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classmodel_a8d4c4182198242b1fd50808edfbe578f}{getnP}}()}
\DoxyCodeLine{00078\ \ \ \ \ \{}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ nP;}
\DoxyCodeLine{00080\ \ \ \ \ \}}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{keywordtype}{double}\ H(vector<double>\ f,\ vector<double>\ p)}
\DoxyCodeLine{00093\ \ \ \ \ \{}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ Hi2=0;}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ Vi;}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ Vi=pot.V(f,p);}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;\ i<nF;\ i++)}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ \ \ \ Hi2\ =\ Hi2\ +\ 1./3.*(f[nF+i]*f[nF+i]/2.);\ \textcolor{comment}{//\ Contribution\ from\ kinetic\ energy}}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ Hi2=Hi2\ +\ 1./3.*Vi;\ \textcolor{comment}{//\ Contribution\ from\ potential\ energy}}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ sqrt(Hi2);}
\DoxyCodeLine{00103\ \ \ \ \ \}}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{keywordtype}{double}\ Hdot(vector<double>\ f)}
\DoxyCodeLine{00112\ \ \ \ \ \{}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ sum=0.;}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;\ i<nF;\ i++)}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ sum=\ sum\ -\/\ 1./2.*(f[nF+i]*f[nF+i]);\ \textcolor{comment}{//\ Sum\ over\ kinetic\ energy\ terms}}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ sum;}
\DoxyCodeLine{00119\ \ \ \ \ \}}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{keywordtype}{double}\ addot(vector<double>\ f,\ vector<double>\ p)}
\DoxyCodeLine{00132\ \ \ \ \ \{}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ sum=0.;}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ Vi;}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ Vi=pot.V(f,p);}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;\ i<nF;\ i++)}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \ \ \ \ sum=\ sum\ -\/\ 1./2.*(f[nF+i]*f[nF+i]);\ \textcolor{comment}{//\ Sum\ over\ kinetic\ energy\ terms}}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1./3.*(sum+Vi);\ \textcolor{comment}{//\ Related\ to\ acceleration\ equation}}
\DoxyCodeLine{00141\ \ \ \ \ \}}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00152\ \ \ \ \ \textcolor{keywordtype}{double}\ Ep(vector<double>\ f,vector<double>\ p)}
\DoxyCodeLine{00153\ \ \ \ \ \{}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ Hi\ =\ H(f,p);}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ mdotH=0.;}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;\ i<nF;\ i++)}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ mdotH=\ mdotH\ +\ 1./2.*(f[nF+i]*f[nF+i]);\ \textcolor{comment}{//\ Sum\ of\ kinetic\ energy\ densities}}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ mdotH/(Hi*Hi);}
\DoxyCodeLine{00161\ \ \ \ \ \}}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00173\ \ \ \ \ \textcolor{keywordtype}{double}\ Eta(vector<double>\ f,vector<double>\ p)}
\DoxyCodeLine{00174\ \ \ \ \ \{}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ V\ =\ pot.V(f,p);}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ vector<double>\ Vp\ =\ pot.dV(f,p);\ \textcolor{comment}{//\ First\ derivative\ of\ the\ potential}}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ Et\ =\ 0;}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ Hi\ =\ H(f,p);}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ nF;\ i++)\{}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ is\ a\ specific\ definition\ of\ Eta\ relevant\ to\ the\ Transport\ formalism\ or\ particular\ models.}}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ It\ might\ differ\ from\ standard\ single-\/field\ definitions.}}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ Et\ +=\ (3*Hi*f[nF+i]\ +\ Vp[i])/\ f[nF+i];}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ Et/Hi;}
\DoxyCodeLine{00186\ \ \ \ \ \}}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00200\ \ \ \ \ \textcolor{keywordtype}{double}\ scale(vector<double>\ f,\ vector<double>\ p,\ \ \textcolor{keywordtype}{double}\ N)}
\DoxyCodeLine{00201\ \ \ \ \ \{}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ k\ =\ 1.0;\ \textcolor{comment}{//\ Reference\ wavenumber,\ typically\ set\ to\ 1\ for\ dimensionless\ calculations}}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ a\ =\ exp(N);\ \textcolor{comment}{//\ Scale\ factor\ 'a'}}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ Hi\ =\ H(f,p);\ \textcolor{comment}{//\ Hubble\ rate}}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \ a/(1.+a*Hi/k)/Hi;}
\DoxyCodeLine{00206\ \ \ \ \ \}}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00219\ \ \ \ \ \textcolor{keywordtype}{double}\ dscale(vector<double>\ f,\ vector<double>\ p,\ \textcolor{keywordtype}{double}\ N)}
\DoxyCodeLine{00220\ \ \ \ \ \{}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ k\ =\ 1.0;\ \textcolor{comment}{//\ Reference\ wavenumber}}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ a\ =\ exp(N);\ \textcolor{comment}{//\ Scale\ factor\ 'a'}}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ Hi\ =\ H(f,p);\ \textcolor{comment}{//\ Hubble\ rate}}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ Hdi\ =\ Hdot(f);\ \textcolor{comment}{//\ Derivative\ of\ Hubble\ rate}}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \ -\/Hdi/Hi/Hi*a/(1.+a*Hi/k)\ +\ a/(1.+a*Hi/k)\ -\/a*(a*Hi*Hi/k\ +\ a*Hdi/k)/(1.+a*Hi/k)/(1.+a*Hi/k)/Hi;}
\DoxyCodeLine{00226\ \ \ \ \ \}}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00238\ \ \ \ \ vector<double>\ u(vector<double>\ f,vector<double>\ p)}
\DoxyCodeLine{00239\ \ \ \ \ \{}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ vector<double>\ u1out(2*nF);}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ vector<double>\ dVi;\ \textcolor{comment}{//\ First\ derivative\ of\ potential}}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ Hi;}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ Hi=H(f,p);}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ First\ nF-\/elements\ of\ u1\ (related\ to\ field\ velocities)}}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;\ i<nF;\ i++)}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \ \ \ \ u1out[i]\ \ =\ f[nF+i]/Hi;}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00249\ }
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ dVi=pot.dV(f,p);\ \textcolor{comment}{//\ Calculate\ dV}}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Second\ nF-\/elements\ of\ u1\ (related\ to\ field\ accelerations)}}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;\ i<nF;\ i++)}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \ \ \ \ u1out[nF+i]\ \ =\ -\/3.*Hi*f[nF+i]/Hi-\/dVi[i]/Hi;}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ u1out;}
\DoxyCodeLine{00257\ \ \ \ \ \}}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00271\ \ \ \ \ vector<double>\ u(vector<double>\ f,vector<double>\ p,\ \textcolor{keywordtype}{double}\ k1,\ \textcolor{keywordtype}{double}\ N)}
\DoxyCodeLine{00272\ \ \ \ \ \{}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ vector<double>\ u2out(2*nF*2*nF);\ \textcolor{comment}{//\ Size\ (2*nF)\ x\ (2*nF)}}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ a\ =\ exp(N);\ \textcolor{comment}{//\ Scale\ factor}}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ ep\ =\ Ep(f,p);\ \textcolor{comment}{//\ Epsilon\ slow-\/roll\ parameter}}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ Hi=H(f,p);\ \textcolor{comment}{//\ Hubble\ rate}}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ s=scale(f,p,N);\ \textcolor{comment}{//\ Scaling\ factor}}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ ds=dscale(f,p,N);\ \textcolor{comment}{//\ Derivative\ of\ scaling\ factor}}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ vector<double>\ dVVi;\ dVVi\ =\ pot.dVV(f,p);\ \textcolor{comment}{//\ Second\ derivative\ of\ potential}}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ vector<double>\ dVi;\ dVi\ =\ \ pot.dV(f,p);\ \textcolor{comment}{//\ First\ derivative\ of\ potential}}
\DoxyCodeLine{00281\ }
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i\ =\ 0;\ i<nF;\ i++)}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ j\ =\ 0;\ j<nF;\ j++)\{}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Off-\/diagonal\ terms\ related\ to\ field-\/velocity\ mixing}}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u2out[i+\ j*2*nF]=0.;}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u2out[i+(j+nF)*2*nF]=0.;}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Terms\ involving\ potential\ derivatives\ and\ field\ velocities}}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u2out[i+nF+(j)*2*nF]=(-\/dVVi[i\ +\ nF*j]\ +\ (-\/3.+ep)*f[nF+i]*f[nF+j]\ +\ 1./Hi*(-\/dVi[i])*f[nF+j]\ +\ 1./Hi*f[nF+i]*(-\/dVi[j])\ )/Hi\ *s;}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u2out[i+nF+(j+nF)*2*nF]=0.;}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Diagonal\ terms\ modified\ for\ specific\ components}}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(i==j)\{}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u2out[i+nF+(j)*2*nF]=u2out[i+nF+(j)*2*nF]-\/1.0*(k1*k1)/(a*a)/Hi\ \ *\ s\ ;}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u2out[i+(j+nF)*2*nF]=u2out[i+(j+nF)*2*nF]\ +\ 1./Hi/s;}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ u2out[i+nF+(j+nF)*2*nF]=\ u2out[i+nF+(j+nF)*2*nF]\ -\/\ 3.0*Hi/Hi\ \ +\ ds/s/Hi;}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ u2out;}
\DoxyCodeLine{00299\ \ \ \ \ \}}
\DoxyCodeLine{00300\ }
\DoxyCodeLine{00312\ \ \ \ \ vector<double>\ \mbox{\hyperlink{classmodel_a712380a6eec709a4323af118e29078cd}{w}}(vector<double>\ f,vector<double>\ p,\ \textcolor{keywordtype}{double}\ k1,\ \textcolor{keywordtype}{double}\ N)}
\DoxyCodeLine{00313\ \ \ \ \ \{}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ nT\ =\ 1;\ \textcolor{comment}{//\ Number\ of\ tensor\ modes,\ typically\ 1\ for\ standard\ models}}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ a\ =\ exp(N);\ \textcolor{comment}{//\ Scale\ factor}}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ vector<double>\ w2out(2*nT*2*nT);\ \textcolor{comment}{//\ Size\ (2*nT)\ x\ (2*nT)}}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ Hi=H(f,p);\ \textcolor{comment}{//\ Hubble\ rate}}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ s=scale(f,p,N);\ \textcolor{comment}{//\ Scaling\ factor}}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ ds=dscale(f,p,N);\ \textcolor{comment}{//\ Derivative\ of\ scaling\ factor}}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ vector<double>\ dVVi;}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ dVVi\ =\ pot.dVV(f,p);\ \textcolor{comment}{//\ Second\ derivative\ of\ potential}}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ vector<double>\ dVi;}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ dVi\ =\ \ pot.dV(f,p);\ \textcolor{comment}{//\ First\ derivative\ of\ potential}}
\DoxyCodeLine{00324\ }
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ w2out[0+\ 0*2*nT]=0.;\ \textcolor{comment}{//\ (0,0)\ component}}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ w2out[0+1*2*nT]=+\ 1./Hi;\ \textcolor{comment}{//\ (0,1)\ component}}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ w2out[1+(0)*2*nT]\ =\ -\/1.0*(k1*k1)/(a*a)/Hi;\ \textcolor{comment}{//\ (1,0)\ component\ (related\ to\ momentum\ and\ wavenumber)}}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ w2out[1+(1)*2*nT]=\ -\/\ 3.0*Hi/Hi\ ;\ \textcolor{comment}{//\ (1,1)\ component\ (related\ to\ damping)}}
\DoxyCodeLine{00329\ }
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ w2out;}
\DoxyCodeLine{00331\ \ \ \ \ \}}
\DoxyCodeLine{00332\ }
\DoxyCodeLine{00347\ \ \ \ \ vector<double>\ Acalc(vector<double>\ f,\ vector<double>\ p,\ \textcolor{keywordtype}{double}\ k1,\ \textcolor{keywordtype}{double}\ k2,\ \textcolor{keywordtype}{double}\ k3,\textcolor{keywordtype}{double}\ N)}
\DoxyCodeLine{00348\ \ \ \ \ \{}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ a\ =\ exp(N);\ \textcolor{comment}{//\ Scale\ factor}}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ Vi=pot.V(f,p);\ \textcolor{comment}{//\ Potential\ value}}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ Hi=H(f,p);\ \textcolor{comment}{//\ Hubble\ rate}}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ vector<double>\ dVVi;}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ dVVi=pot.dVV(f,p);\ \textcolor{comment}{//\ Second\ derivative\ of\ potential}}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ vector<double>\ dVi;}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ dVi\ =\ \ pot.dV(f,p);\ \textcolor{comment}{//\ First\ derivative\ of\ potential}}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ vector<double>\ dVVVi;}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ dVVVi=pot.dVVV(f,p);\ \textcolor{comment}{//\ Third\ derivative\ of\ potential}}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ vector<double>\ Xi(nF);\ \textcolor{comment}{//\ Auxiliary\ vector}}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ vector<double>\ A(nF*nF*nF);\ \textcolor{comment}{//\ Resultant\ A\ tensor\ (flattened)}}
\DoxyCodeLine{00361\ }
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ sum1=0;}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;i<nF;i++)\{sum1=sum1+f[nF+i]*f[nF+i];\}\ \textcolor{comment}{//\ Sum\ of\ squared\ velocities}}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;i<nF;i++)\{Xi[i]\ =\ 2.*(-\/dVi[i]-\/3.*Hi*f[nF+i])+f[nF+i]/Hi*sum1;\}\ \textcolor{comment}{//\ Populate\ Xi}}
\DoxyCodeLine{00365\ }
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;i<nF;i++)\{\textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ j=0;j<nF;j++)\{\textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ k=0;k<nF;k++)\{}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \ \ \ \ A[i\ +\ j*nF\ +k*\ nF*nF]\ =\ -\/1./3.\ *\ dVVVi[i\ +\ j*nF\ +k*\ nF*nF]\ \textcolor{comment}{//\ Terms\ from\ third\ derivative\ of\ potential}}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ \ \ \ \ -\/\ 1./3.*f[nF\ +\ i]/2./Hi*\ dVVi[j\ +\ k*nF]}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \ \ \ \ \ \ -\/\ 1./3.*f[nF\ +\ j]/2./Hi*\ dVVi[i\ +\ k*nF]}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ \ \ \ \ -\/\ 1./3.*f[nF\ +\ k]/2./Hi*\ dVVi[i\ +\ j*nF]\ \textcolor{comment}{//\ Terms\ from\ second\ derivative\ of\ potential}}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \ \ \ \ \ \ +\ 1./3.*f[nF\ +\ i]\ *\ f[nF\ +\ j]/8./Hi/Hi\ *\ Xi[k]}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \ \ \ \ \ \ +\ 1./3.*f[nF\ +\ i]\ *\ f[nF\ +\ k]/8./Hi/Hi\ *\ Xi[j]}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ \ \ \ \ +\ 1./3.*f[nF\ +\ k]\ *\ f[nF\ +\ j]/8./Hi/Hi\ *\ Xi[i]\ \textcolor{comment}{//\ Terms\ from\ Xi\ and\ velocities}}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \ \ \ \ +\ 1./3.*f[nF\ +\ i]/32./Hi/Hi/Hi\ *\ Xi[j]\ *Xi[k]}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ \ \ \ \ +\ 1./3.*f[nF\ +\ j]/32./Hi/Hi/Hi\ *\ Xi[i]\ *Xi[k]}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \ \ \ \ +\ 1./3.*f[nF\ +\ k]/32./Hi/Hi/Hi\ *\ Xi[i]\ *Xi[j]}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \ \ \ \ +\ 1.*f[nF\ +\ i]*f[nF\ +\ j]*f[nF\ +\ k]/8./Hi/Hi/Hi*2.*Vi\ \textcolor{comment}{//\ Terms\ involving\ field\ products\ and\ potential}}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ \ \ \ \ -\/\ 1./3.*f[nF\ +\ i]/32./Hi/Hi/Hi\ *\ Xi[j]\ *\ Xi[k]\ *\ (k2*k2+k3*k3\ -\/\ k1*k1)*(k2*k2+k3*k3\ -\/\ k1*k1)/k2/k2/k3/k3/4.}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ \ \ \ \ -\/\ 1./3.*f[nF\ +\ j]/32./Hi/Hi/Hi\ *\ Xi[i]\ *\ Xi[k]\ *\ (k1*k1+k3*k3\ -\/\ k2*k2)*(k1*k1+k3*k3\ -\/\ k2*k2)/k1/k1/k3/k3/4.}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ \ \ \ \ -\/\ 1./3.*f[nF\ +\ k]/32./Hi/Hi/Hi\ *\ Xi[i]\ *\ Xi[j]\ *\ (k1*k1+k2*k2\ -\/\ k3*k3)*(k1*k1+k2*k2\ -\/\ k3*k3)/k1/k1/k2/k2/4.;\ \textcolor{comment}{//\ Wavenumber-\/dependent\ terms}}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(j==k)\{A[i\ +\ j*nF\ +k*\ nF*nF]\ =\ A[i\ +\ j*nF\ +k*\ nF*nF]\ +\ 1./3.*f[nF+i]/2./Hi*(-\/k2*k2-\/k3*k3+k1*k1)/a/a/2.;\}}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(i==k)\{A[i\ +\ j*nF\ +k*\ nF*nF]\ =\ A[i\ +\ j*nF\ +k*\ nF*nF]\ +\ 1./3.*f[nF+j]/2./Hi*(-\/k1*k1-\/k3*k3+k2*k2)/a/a/2.;\}}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(i==j)\{A[i\ +\ j*nF\ +k*\ nF*nF]\ =\ A[i\ +\ j*nF\ +k*\ nF*nF]\ +\ 1./3.*f[nF+k]/2./Hi*(-\/k2*k2-\/k1*k1+k3*k3)/a/a/2.;\}}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ \ \ \ \ \}\}\}}
\DoxyCodeLine{00385\ }
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ A;}
\DoxyCodeLine{00387\ \ \ \ \ \}}
\DoxyCodeLine{00388\ }
\DoxyCodeLine{00404\ \ \ \ \ vector<double>\ AScalc(vector<double>\ f,\ vector<double>\ p,\ \textcolor{keywordtype}{double}\ k1,\ \textcolor{keywordtype}{double}\ k2,\ \textcolor{keywordtype}{double}\ k3,\textcolor{keywordtype}{double}\ N)}
\DoxyCodeLine{00405\ \ \ \ \ \{}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ Vi=pot.V(f,p);\ \textcolor{comment}{//\ Potential\ value}}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ Hi=H(f,p);\ \textcolor{comment}{//\ Hubble\ rate}}
\DoxyCodeLine{00408\ }
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ vector<double>\ dVVi;}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ dVVi=pot.dVV(f,p);\ \textcolor{comment}{//\ Second\ derivative\ of\ potential}}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ vector<double>\ dVi;}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ dVi\ =\ \ pot.dV(f,p);\ \textcolor{comment}{//\ First\ derivative\ of\ potential}}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \ \ vector<double>\ dVVVi;}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \ \ dVVVi=pot.dVVV(f,p);\ \textcolor{comment}{//\ Third\ derivative\ of\ potential}}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ vector<double>\ Xi(nF);\ \textcolor{comment}{//\ Auxiliary\ vector}}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ vector<double>\ AS(nF*nF*nF);\ \textcolor{comment}{//\ Resultant\ AS\ tensor\ (flattened)}}
\DoxyCodeLine{00417\ }
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ sum1=0;}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;i<nF;i++)\{sum1=sum1+f[nF+i]*f[nF+i];\}\ \textcolor{comment}{//\ Sum\ of\ squared\ velocities}}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;i<nF;i++)\{Xi[i]\ =\ 2.*(-\/dVi[i]-\/3.*Hi*f[nF+i])+f[nF+i]/Hi*sum1;\}\ \textcolor{comment}{//\ Populate\ Xi}}
\DoxyCodeLine{00421\ }
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;i<nF;i++)\{\textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ j=0;j<nF;j++)\{\textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ k=0;k<nF;k++)\{}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \ \ \ \ AS[i\ +\ j*nF\ +k*\ nF*nF]\ =\ -\/1./3.\ *\ dVVVi[i\ +\ j*nF\ +k*\ nF*nF]}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ \ \ \ \ -\/\ 1./3.*f[nF\ +\ i]/2./Hi*\ dVVi[j\ +\ k*nF]}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \ \ \ \ \ -\/\ 1./3.*f[nF\ +\ j]/2./Hi*\ dVVi[i\ +\ k*nF]}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \ \ \ \ -\/\ 1./3.*f[nF\ +\ k]/2./Hi*\ dVVi[i\ +\ j*nF]}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \ \ \ \ +\ 1./3.*f[nF\ +\ i]\ *\ f[nF\ +\ j]/8./Hi/Hi\ *\ Xi[k]}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \ \ \ \ +\ 1./3.*f[nF\ +\ i]\ *\ f[nF\ +\ k]/8./Hi/Hi\ *\ Xi[j]}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ \ \ \ \ +\ 1./3.*f[nF\ +\ k]\ *\ f[nF\ +\ j]/8./Hi/Hi\ *\ Xi[i]}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ \ \ \ \ +\ 1./3.*f[nF\ +\ i]/32./Hi/Hi/Hi\ *\ Xi[j]\ *Xi[k]}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ \ \ \ \ \ +\ 1./3.*f[nF\ +\ j]/32./Hi/Hi/Hi\ *\ Xi[i]\ *Xi[k]}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ \ \ \ \ +\ 1./3.*f[nF\ +\ k]/32./Hi/Hi/Hi\ *\ Xi[i]\ *Xi[j]}
\DoxyCodeLine{00433\ \ \ \ \ \ \ \ \ \ \ \ \ +\ 1.*f[nF\ +\ i]*f[nF\ +\ j]*f[nF\ +\ k]/8./Hi/Hi/Hi*2.*Vi}
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ \ \ \ \ -\/\ 1./3.*f[nF\ +\ i]/32./Hi/Hi/Hi\ *\ Xi[j]\ *\ Xi[k]\ *\ (k2*k2+k3*k3\ -\/\ k1*k1)*(k2*k2+k3*k3\ -\/\ k1*k1)/k2/k2/k3/k3/4.}
\DoxyCodeLine{00435\ \ \ \ \ \ \ \ \ \ \ \ \ -\/\ 1./3.*f[nF\ +\ j]/32./Hi/Hi/Hi\ *\ Xi[i]\ *\ Xi[k]\ *\ (k1*k1+k3*k3\ -\/\ k2*k2)*(k1*k1+k3*k3\ -\/\ k2*k2)/k1/k1/k3/k3/4.}
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ \ \ \ \ -\/\ 1./3.*f[nF\ +\ k]/32./Hi/Hi/Hi\ *\ Xi[i]\ *\ Xi[j]\ *\ (k1*k1+k2*k2\ -\/\ k3*k3)*(k1*k1+k2*k2\ -\/\ k3*k3)/k1/k1/k2/k2/4.;}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \}\}\}}
\DoxyCodeLine{00438\ }
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ AS;}
\DoxyCodeLine{00440\ \ \ \ \ \}}
\DoxyCodeLine{00441\ }
\DoxyCodeLine{00442\ }
\DoxyCodeLine{00457\ \ \ \ vector<double>\ Bcalc(vector<double>\ f,vector<double>\ p,\ \textcolor{keywordtype}{double}\ k1,\ \textcolor{keywordtype}{double}\ k2,\ \textcolor{keywordtype}{double}\ k3,\textcolor{keywordtype}{double}\ N)}
\DoxyCodeLine{00458\ \ \ \ \ \{}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ Hi=H(f,p);\ \textcolor{comment}{//\ Hubble\ rate}}
\DoxyCodeLine{00460\ }
\DoxyCodeLine{00461\ \ \ \ \ \ \ \ \ vector<double>\ dVVi;}
\DoxyCodeLine{00462\ \ \ \ \ \ \ \ \ dVVi=pot.dVV(f,p);\ \textcolor{comment}{//\ Second\ derivative\ of\ potential}}
\DoxyCodeLine{00463\ \ \ \ \ \ \ \ \ vector<double>\ dVi;}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ dVi\ =\ \ pot.dV(f,p);\ \textcolor{comment}{//\ First\ derivative\ of\ potential}}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ \ vector<double>\ dVVVi;}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ dVVVi=pot.dVVV(f,p);\ \textcolor{comment}{//\ Third\ derivative\ of\ potential}}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ vector<double>\ Xi(nF);\ \textcolor{comment}{//\ Auxiliary\ vector}}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ vector<double>\ B(nF*nF*nF);\ \textcolor{comment}{//\ Resultant\ B\ tensor\ (flattened)}}
\DoxyCodeLine{00469\ }
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ sum1=0;}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;i<nF;i++)\{sum1=sum1+f[nF+i]*f[nF+i];\}\ \textcolor{comment}{//\ Sum\ of\ squared\ velocities}}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;i<nF;i++)\{Xi[i]\ =\ 2.0*(-\/dVi[i]-\/3.0*Hi*f[nF+i])+f[nF+i]/Hi*sum1;\}\ \textcolor{comment}{//\ Populate\ Xi}}
\DoxyCodeLine{00473\ }
\DoxyCodeLine{00474\ }
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;i<nF;i++)\{\textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ j=0;j<nF;j++)\{\textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ k=0;k<nF;k++)\{}
\DoxyCodeLine{00476\ \ \ \ \ \ \ \ \ \ \ \ \ B[i\ +\ j*nF\ +k*\ nF*nF]\ =\ 1.*f[nF\ +\ i]*f[nF+j]*f[nF+k]/4./Hi/Hi\ \textcolor{comment}{//\ Terms\ with\ product\ of\ velocities}}
\DoxyCodeLine{00477\ \ \ \ \ \ \ \ \ \ \ \ \ -\/\ 1./2.*f[nF\ +\ i]\ *\ f[nF\ +\ k]/8./Hi/Hi/Hi\ *\ Xi[j]}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \ \ \ \ \ \ -\/\ 1./2.*f[nF\ +\ j]\ *\ f[nF\ +\ k]/8./Hi/Hi/Hi\ *\ Xi[i]\ \textcolor{comment}{//\ Terms\ with\ Xi\ and\ velocities}}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \ \ \ \ \ \ +\ 1./2.*f[nF\ +\ i]\ *\ f[nF\ +\ k]/8./Hi/Hi/Hi\ *\ Xi[j]*(k2*k2+k3*k3\ -\/\ k1*k1)*(k2*k2+k3*k3\ -\/\ k1*k1)/k2/k2/k3/k3/4.}
\DoxyCodeLine{00480\ \ \ \ \ \ \ \ \ \ \ \ \ +\ 1./2.*f[nF\ +\ j]\ *\ f[nF\ +\ k]/8./Hi/Hi/Hi\ *\ Xi[i]*(k1*k1+k3*k3\ -\/\ k2*k2)*(k1*k1+k3*k3\ -\/\ k2*k2)/k1/k1/k3/k3/4.;\ \textcolor{comment}{//\ Wavenumber-\/dependent\ terms}}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(j==k)\{B[i\ +\ j*nF\ +k*\ nF*nF]\ =\ B[i\ +\ j*nF\ +k*\ nF*nF]\ -\/\ 1.*Xi[i]/4./Hi*(-\/k1*k1-\/k2*k2+k3*k3)/k1/k1/2.;\}}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(i==k)\{B[i\ +\ j*nF\ +k*\ nF*nF]\ =\ B[i\ +\ j*nF\ +k*\ nF*nF]\ -\/\ 1.*Xi[j]/4./Hi*(-\/k1*k1-\/k2*k2+k3*k3)/k2/k2/2.;\}}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \ \ \}\}\}}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ B;}
\DoxyCodeLine{00485\ \ \ \ \ \}}
\DoxyCodeLine{00486\ }
\DoxyCodeLine{00501\ \ \ \ \ vector<double>\ Ccalc(vector<double>\ f,\ vector<double>\ p,\ \textcolor{keywordtype}{double}\ k1,\ \textcolor{keywordtype}{double}\ k2,\ \textcolor{keywordtype}{double}\ k3,\textcolor{keywordtype}{double}\ N)}
\DoxyCodeLine{00502\ \ \ \ \ \{}
\DoxyCodeLine{00503\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ Hi=H(f,p);\ \textcolor{comment}{//\ Hubble\ rate}}
\DoxyCodeLine{00504\ }
\DoxyCodeLine{00505\ \ \ \ \ \ \ \ \ vector<double>\ dVVi;}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ dVVi=pot.dVV(f,p);\ \textcolor{comment}{//\ Second\ derivative\ of\ potential}}
\DoxyCodeLine{00507\ \ \ \ \ \ \ \ \ vector<double>\ dVi;}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \ \ dVi\ =\ \ pot.dV(f,p);\ \textcolor{comment}{//\ First\ derivative\ of\ potential}}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \ \ vector<double>\ dVVVi;}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \ \ dVVVi=pot.dVVV(f,p);\ \textcolor{comment}{//\ Third\ derivative\ of\ potential}}
\DoxyCodeLine{00511\ \ \ \ \ \ \ \ \ vector<double>\ Xi(nF);\ \textcolor{comment}{//\ Auxiliary\ vector}}
\DoxyCodeLine{00512\ \ \ \ \ \ \ \ \ vector<double>\ C(nF*nF*nF);\ \textcolor{comment}{//\ Resultant\ C\ tensor\ (flattened)}}
\DoxyCodeLine{00513\ }
\DoxyCodeLine{00514\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ sum1=0;}
\DoxyCodeLine{00515\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;i<nF;i++)\{sum1=sum1+f[nF+i]*f[nF+i];\}\ \textcolor{comment}{//\ Sum\ of\ squared\ velocities}}
\DoxyCodeLine{00516\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;i<nF;i++)\{Xi[i]\ =\ 2.*(-\/dVi[i]-\/3.*Hi*f[nF+i])+f[nF+i]/Hi*sum1;\}\ \textcolor{comment}{//\ Populate\ Xi}}
\DoxyCodeLine{00517\ }
\DoxyCodeLine{00518\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;i<nF;i++)\{\textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ j=0;j<nF;j++)\{\textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ k=0;k<nF;k++)\{}
\DoxyCodeLine{00519\ \ \ \ \ \ \ \ \ \ \ \ \ C[i\ +\ j*nF\ +k*\ nF*nF]\ =\ 1.*f[nF\ +\ i]*f[nF+j]*f[nF+k]/8./Hi/Hi/Hi\ \textcolor{comment}{//\ Terms\ with\ product\ of\ velocities}}
\DoxyCodeLine{00520\ \ \ \ \ \ \ \ \ \ \ \ \ -\/\ 1.*f[nF\ +\ i]\ *\ f[nF+j]\ *f[nF+k]/8./Hi/Hi/Hi\ *(k1*k1+k2*k2\ -\/\ k3*k3)*(k1*k1+k2*k2\ -\/\ k3*k3)/k1/k1/k2/k2/4.\ ;\ \textcolor{comment}{//\ Wavenumber-\/dependent\ terms}}
\DoxyCodeLine{00521\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(i==j)\{C[i\ +\ j*nF\ +k*\ nF*nF]\ =\ C[i\ +\ j*nF\ +k*\ nF*nF]\ -\/\ 1.*f[nF+k]/2./Hi;\}\ \textcolor{comment}{//\ Diagonal\ terms}}
\DoxyCodeLine{00522\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(j==k)\{C[i\ +\ j*nF\ +k*\ nF*nF]\ =\ C[i\ +\ j*nF\ +k*\ nF*nF]\ +\ f[nF+i]/2./Hi*(-\/k1*k1-\/k3*k3+k2*k2)/k1/k1/2.;\}}
\DoxyCodeLine{00523\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(i==k)\{C[i\ +\ j*nF\ +k*\ nF*nF]\ =\ C[i\ +\ j*nF\ +k*\ nF*nF]\ +\ f[nF+j]/2./Hi*(-\/k2*k2-\/k3*k3+k1*k1)/k2/k2/2.;\}}
\DoxyCodeLine{00524\ \ \ \ \ \ \ \ \ \}\}\}}
\DoxyCodeLine{00525\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ C;}
\DoxyCodeLine{00526\ \ \ \ \ \}}
\DoxyCodeLine{00527\ }
\DoxyCodeLine{00542\ \ \ \ \ vector<double>\ u(vector<double>\ f,\ vector<double>\ p,\ \textcolor{keywordtype}{double}\ k1,\ \textcolor{keywordtype}{double}\ k2,\ \textcolor{keywordtype}{double}\ k3,\textcolor{keywordtype}{double}\ N)}
\DoxyCodeLine{00543\ \ \ \ \ \{}
\DoxyCodeLine{00544\ \ \ \ \ \ \ \ \ vector<double>\ \ A\_tensor,\ B\_tensor,\ B2\_tensor,\ B3\_tensor,\ C\_tensor,\ C2\_tensor,\ C3\_tensor;}
\DoxyCodeLine{00545\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ Hi;}
\DoxyCodeLine{00546\ \ \ \ \ \ \ \ \ Hi=H(f,p);\ \textcolor{comment}{//\ Hubble\ rate}}
\DoxyCodeLine{00547\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ s=scale(f,p,N);\ \textcolor{comment}{//\ Scaling\ factor}}
\DoxyCodeLine{00548\ }
\DoxyCodeLine{00549\ \ \ \ \ \ \ \ \ A\_tensor\ =\ Acalc(f,p,\ k1,\ k2,\ k3\ ,N);}
\DoxyCodeLine{00550\ \ \ \ \ \ \ \ \ B\_tensor\ =\ Bcalc(f,p,\ k2,\ k3,\ k1\ ,N);}
\DoxyCodeLine{00551\ \ \ \ \ \ \ \ \ B2\_tensor\ =\ \ Bcalc(f,p,\ k1,\ k2,\ k3\ ,N);}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ B3\_tensor\ =\ Bcalc(f,p,\ k1,\ k3,\ k2\ ,N);}
\DoxyCodeLine{00553\ \ \ \ \ \ \ \ \ C\_tensor\ =\ \ Ccalc(f,p,\ k1,\ k2,\ k3\ ,N);}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \ \ C2\_tensor\ =\ \ Ccalc(f,p,\ k1,\ k3,\ k2\ ,N);}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \ \ C3\_tensor\ =\ Ccalc(f,p,\ k3,\ k2,\ k1\ ,N);}
\DoxyCodeLine{00556\ }
\DoxyCodeLine{00557\ \ \ \ \ \ \ \ \ vector<double>\ u3out(2*nF*2*nF*2*nF);\ \textcolor{comment}{//\ Resultant\ u3\ tensor\ (flattened)}}
\DoxyCodeLine{00558\ }
\DoxyCodeLine{00559\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;i<nF;i++)\{\textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ j=0;j<nF;j++)\{\textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ k=0;k<nF;k++)\{}
\DoxyCodeLine{00560\ \ \ \ \ \ \ \ \ \ \ \ \ u3out[i+j*2*nF+k*2*nF*2*nF]=\ -\/B\_tensor[j+k*nF+i*nF*nF]/Hi;\ \textcolor{comment}{//\ Term\ related\ to\ B\ tensor\ permutations}}
\DoxyCodeLine{00561\ }
\DoxyCodeLine{00562\ \ \ \ \ \ \ \ \ \ \ \ \ u3out[(i)+(nF+j)*2*nF+k*2*nF*2*nF]=\ -\/C\_tensor[i+j*nF+k*nF*nF]/Hi\ \ /s;}
\DoxyCodeLine{00563\ \ \ \ \ \ \ \ \ \ \ \ \ u3out[(i)+j*2*nF+(k+nF)*2*nF*2*nF]=\ -\/C2\_tensor[i+k*nF+j*nF*nF]/Hi\ /s;}
\DoxyCodeLine{00564\ }
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ \ \ \ \ u3out[(i)+(j+nF)*2*nF+(k+nF)*2*nF*2*nF]=\ 0.;\ \textcolor{comment}{//\ Zero\ component}}
\DoxyCodeLine{00566\ }
\DoxyCodeLine{00567\ \ \ \ \ \ \ \ \ \ \ \ \ u3out[(nF+i)\ +\ j*2*nF\ +\ k*2*nF*2*nF]=\ 3.*A\_tensor[i+j*nF+k*nF*nF]/Hi\ \ *s;}
\DoxyCodeLine{00568\ }
\DoxyCodeLine{00569\ \ \ \ \ \ \ \ \ \ \ \ \ u3out[(nF+i)+(nF+j)*2*nF+k*2*nF*2*nF]=B3\_tensor[i+k*nF+j*nF*nF]/Hi\ ;}
\DoxyCodeLine{00570\ \ \ \ \ \ \ \ \ \ \ \ \ u3out[(nF+i)+(j)*2*nF+(k+nF)*2*nF*2*nF]=B2\_tensor[i+j*nF+k*nF*nF]/Hi\ ;}
\DoxyCodeLine{00571\ }
\DoxyCodeLine{00572\ \ \ \ \ \ \ \ \ \ \ \ \ u3out[(nF+i)+(j+nF)*2*nF\ +\ (k+nF)*2*nF*2*nF]=C3\_tensor[k+j*nF+i*nF*nF]/Hi\ \ /s;}
\DoxyCodeLine{00573\ }
\DoxyCodeLine{00574\ \ \ \ \ \ \ \ \ \}\}\}}
\DoxyCodeLine{00575\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ u3out;}
\DoxyCodeLine{00576\ \ \ \ \ \}}
\DoxyCodeLine{00577\ }
\DoxyCodeLine{00578\ }
\DoxyCodeLine{00590\ \ \ \ \ vector<double>\ N1(vector<double>\ f,vector<double>\ p,\ \textcolor{keywordtype}{double}\ N)}
\DoxyCodeLine{00591\ \ \ \ \ \{}
\DoxyCodeLine{00592\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ Hd=Hdot(f);\ \textcolor{comment}{//\ Derivative\ of\ Hubble\ rate}}
\DoxyCodeLine{00593\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ Hi=H(f,p);\ \textcolor{comment}{//\ Hubble\ rate}}
\DoxyCodeLine{00594\ \ \ \ \ \ \ \ \ vector<double>\ dVi;\ \textcolor{comment}{//\ First\ derivative\ of\ potential}}
\DoxyCodeLine{00595\ \ \ \ \ \ \ \ \ vector<double>\ Ni(2*nF);\ \textcolor{comment}{//\ Resultant\ N1\ tensor\ (flattened)}}
\DoxyCodeLine{00596\ \ \ \ \ \ \ \ \ dVi=pot.dV(f,p);\ \textcolor{comment}{//\ Calculate\ dV}}
\DoxyCodeLine{00597\ }
\DoxyCodeLine{00598\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;i<nF;i++)\{}
\DoxyCodeLine{00599\ \ \ \ \ \ \ \ \ \ \ \ \ Ni[i]\ =\ 1./2.*Hi/Hd\ *\ f[nF+i];\ \textcolor{comment}{//\ Components\ related\ to\ field\ velocities}}
\DoxyCodeLine{00600\ }
\DoxyCodeLine{00601\ \ \ \ \ \ \ \ \ \ \ \ \ Ni[nF+i]\ =\ 0.\ ;\ \textcolor{comment}{//\ Components\ related\ to\ field\ momenta\ (typically\ zero\ for\ N1)}}
\DoxyCodeLine{00602\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00603\ }
\DoxyCodeLine{00604\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ Ni;}
\DoxyCodeLine{00605\ \ \ \ \ \}}
\DoxyCodeLine{00606\ }
\DoxyCodeLine{00622\ \ \ \ \ vector<double>\ N2(vector<double>\ f,\ vector<double>\ p,\ \textcolor{keywordtype}{double}\ k1,\ \textcolor{keywordtype}{double}\ k2,\ \textcolor{keywordtype}{double}\ k3,\ \textcolor{keywordtype}{double}\ N)}
\DoxyCodeLine{00623\ \ \ \ \ \{}
\DoxyCodeLine{00624\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ Hd=Hdot(f);\ \textcolor{comment}{//\ Derivative\ of\ Hubble\ rate}}
\DoxyCodeLine{00625\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ Hin=H(f,p);\ \textcolor{comment}{//\ Hubble\ rate}}
\DoxyCodeLine{00626\ \ \ \ \ \ \ \ \ vector<double>\ dVi,\ dVVi;}
\DoxyCodeLine{00627\ \ \ \ \ \ \ \ \ vector<double>\ Nii(2*nF*2*nF);\ \textcolor{comment}{//\ Resultant\ N2\ tensor\ (flattened)}}
\DoxyCodeLine{00628\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ s\ =\ scale(f,p,N);\ \textcolor{comment}{//\ Scaling\ factor}}
\DoxyCodeLine{00629\ \ \ \ \ \ \ \ \ dVi=pot.dV(f,p);\ \textcolor{comment}{//\ First\ derivative\ of\ potential}}
\DoxyCodeLine{00630\ \ \ \ \ \ \ \ \ dVVi=pot.dVV(f,p);\ \textcolor{comment}{//\ Second\ derivative\ of\ potential}}
\DoxyCodeLine{00631\ }
\DoxyCodeLine{00632\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ sum3\ =\ 0.0;}
\DoxyCodeLine{00633\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;i<nF;i++)\{sum3=sum3+dVi[i]*f[nF+i]/Hin/Hin/Hin;\}\ \textcolor{comment}{//\ Auxiliary\ sum}}
\DoxyCodeLine{00634\ }
\DoxyCodeLine{00635\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ ep\ =\ -\/Hd/Hin/Hin;\ \textcolor{comment}{//\ Epsilon\ slow-\/roll\ parameter}}
\DoxyCodeLine{00636\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;i<nF;i++)\{\textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ j=0;\ j<nF;\ j++)\{}
\DoxyCodeLine{00637\ \ \ \ \ \ \ \ \ Nii[i\ +\ (j)\ *\ 2*nF]=\ 2./ep/Hin/Hin/6.\ *\ (f[nF+i]*f[nF+j]\ *(-\/3./2.\ +\ 9./2./ep\ +\ 3./4.*sum3/ep/ep));\ \textcolor{comment}{//\ Components\ for\ N\_ij}}
\DoxyCodeLine{00638\ \ \ \ \ \ \ \ \ Nii[i\ +\ (j+nF)\ *\ 2*nF]=2./ep/Hin/Hin/6.*3./2.*f[i+nF]*f[j+nF]/Hin/ep\ \ /s;}
\DoxyCodeLine{00639\ \ \ \ \ \ \ \ \ Nii[i+nF\ +\ (j)\ *\ 2*nF]=2./ep/Hin/Hin/6.*3./2.*f[i+nF]*f[j+nF]/Hin/ep\ \ /s;}
\DoxyCodeLine{00640\ \ \ \ \ \ \ \ \ Nii[i+nF\ +\ (j+nF)\ *\ 2*nF]=0.;\ \textcolor{comment}{//\ Zero\ component}}
\DoxyCodeLine{00641\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(i==j)\{Nii[i+nF+(j)*2*nF]\ =\ Nii[i+nF\ +\ (j)\ *\ 2*nF]\ -\/\ 2./ep/Hin/Hin/6.\ *\ 3./2.*Hin/k1/k1*((-\/k2*k2-\/k3*k3+k1*k1)/2.\ +\ k3*k3)\ \ /s;}
\DoxyCodeLine{00642\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Nii[i+(j+nF)*2*nF]\ =\ Nii[i\ +\ (j+nF)\ *\ 2*nF]\ -\/\ 2./ep/Hin/Hin/6.\ *\ 3./2.*Hin/k1/k1*((-\/k2*k2-\/k3*k3+k1*k1)/2.\ +\ k2*k2)\ \ /s;\}}
\DoxyCodeLine{00643\ \ \ \ \ \ \ \ \ \}\}}
\DoxyCodeLine{00644\ }
\DoxyCodeLine{00645\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ Nii;}
\DoxyCodeLine{00646\ }
\DoxyCodeLine{00647\ \ \ \ \ \}}
\DoxyCodeLine{00648\ \};}
\DoxyCodeLine{00649\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
